# Mimir Configuration for APES Monitoring Stack
# Optimized for metrics storage and PostgreSQL integration
# Version: 2.14.1 (2025)

# Disable multitenancy
multitenancy_enabled: false

# Server configuration
server:
  http_listen_port: 9009
  log_level: info
  log_format: logfmt

# Common configuration - 2025 Best Practices
common:
  storage:
    backend: filesystem
    filesystem:
      dir: /data/mimir

# Distributor configuration
distributor:
  pool:
    health_check_ingesters: true
  ha_tracker:
    enable_ha_tracker: false
  ring:
    kvstore:
      store: memberlist

# Ingester configuration
ingester:
  ring:
    kvstore:
      store: memberlist
    replication_factor: 1
    final_sleep: 0s
    num_tokens: 128
    unregister_on_shutdown: false

# Store gateway configuration
store_gateway:
  sharding_ring:
    replication_factor: 1
    kvstore:
      store: memberlist

# Compactor configuration
compactor:
  data_dir: /data/mimir/compactor
  sharding_ring:
    kvstore:
      store: memberlist

# Blocks storage configuration - separate from ruler storage
blocks_storage:
  backend: filesystem
  filesystem:
    dir: /data/mimir/blocks

# Frontend configuration
frontend:
  log_queries_longer_than: 5s
  max_retries: 5
  split_queries_by_interval: 24h

# Querier configuration
querier:
  max_concurrent: 16
  timeout: 2m
  max_samples: 50000000
  default_evaluation_interval: 1m

# Query scheduler configuration
query_scheduler:
  max_outstanding_requests_per_tenant: 100

# Ruler configuration - disabled to avoid storage conflicts
ruler:
  enable_api: false

# Alertmanager configuration
alertmanager:
  enable_api: true
  data_dir: /data/mimir/alertmanager
  external_url: http://localhost:9009/alertmanager
  sharding_ring:
    replication_factor: 1
    kvstore:
      store: memberlist

# Memberlist configuration
memberlist:
  node_name: mimir-1
  randomize_node_name: false
  stream_timeout: 10s
  gossip_interval: 200ms
  gossip_nodes: 3
  dead_node_reclaim_time: 0s
  compression_enabled: true

# Limits configuration
limits:
  max_global_series_per_user: 150000
  max_global_series_per_metric: 20000
  ingestion_rate: 10000
  ingestion_burst_size: 200000
  max_label_names_per_series: 30
  max_label_name_length: 1024
  max_label_value_length: 4096
  max_metadata_length: 1024
  creation_grace_period: 10m
  enforce_metadata_metric_name: false
  ingestion_tenant_shard_size: 0
  max_global_metadata_per_user: 8000
  max_global_metadata_per_metric: 10
  max_global_exemplars_per_user: 100000

# Runtime configuration
runtime_config:
  file: ""

# Activity tracker - disabled for simplified setup
activity_tracker:
  filepath: ""

# Usage stats
usage_stats:
  enabled: false
